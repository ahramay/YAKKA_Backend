{"C:\\Users\\EuanMorgan\\Documents\\Code\\Yakka\\Yakka-Api\\src\\utils\\createServer.ts":{"path":"C:\\Users\\EuanMorgan\\Documents\\Code\\Yakka\\Yakka-Api\\src\\utils\\createServer.ts","statementMap":{"0":{"start":{"line":2,"column":16},"end":{"line":10,"column":1}},"1":{"start":{"line":3,"column":28},"end":{"line":3,"column":110}},"2":{"start":{"line":3,"column":91},"end":{"line":3,"column":106}},"3":{"start":{"line":4,"column":4},"end":{"line":9,"column":7}},"4":{"start":{"line":5,"column":36},"end":{"line":5,"column":97}},"5":{"start":{"line":5,"column":42},"end":{"line":5,"column":70}},"6":{"start":{"line":5,"column":85},"end":{"line":5,"column":95}},"7":{"start":{"line":6,"column":35},"end":{"line":6,"column":100}},"8":{"start":{"line":6,"column":41},"end":{"line":6,"column":73}},"9":{"start":{"line":6,"column":88},"end":{"line":6,"column":98}},"10":{"start":{"line":7,"column":32},"end":{"line":7,"column":116}},"11":{"start":{"line":8,"column":8},"end":{"line":8,"column":78}},"12":{"start":{"line":11,"column":22},"end":{"line":13,"column":1}},"13":{"start":{"line":12,"column":4},"end":{"line":12,"column":62}},"14":{"start":{"line":14,"column":0},"end":{"line":14,"column":62}},"15":{"start":{"line":15,"column":18},"end":{"line":15,"column":53}},"16":{"start":{"line":16,"column":17},"end":{"line":16,"column":53}},"17":{"start":{"line":17,"column":17},"end":{"line":17,"column":36}},"18":{"start":{"line":18,"column":21},"end":{"line":18,"column":75}},"19":{"start":{"line":19,"column":21},"end":{"line":19,"column":75}},"20":{"start":{"line":20,"column":21},"end":{"line":20,"column":75}},"21":{"start":{"line":21,"column":14},"end":{"line":21,"column":55}},"22":{"start":{"line":22,"column":36},"end":{"line":22,"column":72}},"23":{"start":{"line":23,"column":18},"end":{"line":23,"column":62}},"24":{"start":{"line":24,"column":21},"end":{"line":24,"column":68}},"25":{"start":{"line":25,"column":23},"end":{"line":25,"column":52}},"26":{"start":{"line":26,"column":23},"end":{"line":26,"column":73}},"27":{"start":{"line":28,"column":21},"end":{"line":76,"column":2}},"28":{"start":{"line":28,"column":27},"end":{"line":76,"column":2}},"29":{"start":{"line":31,"column":16},"end":{"line":33,"column":6}},"30":{"start":{"line":35,"column":4},"end":{"line":35,"column":41}},"31":{"start":{"line":36,"column":4},"end":{"line":36,"column":32}},"32":{"start":{"line":38,"column":4},"end":{"line":38,"column":76}},"33":{"start":{"line":39,"column":4},"end":{"line":39,"column":78}},"34":{"start":{"line":40,"column":4},"end":{"line":59,"column":7}},"35":{"start":{"line":60,"column":4},"end":{"line":63,"column":7}},"36":{"start":{"line":66,"column":4},"end":{"line":66,"column":39}},"37":{"start":{"line":67,"column":4},"end":{"line":67,"column":65}},"38":{"start":{"line":68,"column":4},"end":{"line":68,"column":64}},"39":{"start":{"line":75,"column":4},"end":{"line":75,"column":15}},"40":{"start":{"line":77,"column":0},"end":{"line":77,"column":31}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":2,"column":44},"end":{"line":2,"column":45}},"loc":{"start":{"line":2,"column":89},"end":{"line":10,"column":1}},"line":2},"1":{"name":"adopt","decl":{"start":{"line":3,"column":13},"end":{"line":3,"column":18}},"loc":{"start":{"line":3,"column":26},"end":{"line":3,"column":112}},"line":3},"2":{"name":"(anonymous_2)","decl":{"start":{"line":3,"column":70},"end":{"line":3,"column":71}},"loc":{"start":{"line":3,"column":89},"end":{"line":3,"column":108}},"line":3},"3":{"name":"(anonymous_3)","decl":{"start":{"line":4,"column":36},"end":{"line":4,"column":37}},"loc":{"start":{"line":4,"column":63},"end":{"line":9,"column":5}},"line":4},"4":{"name":"fulfilled","decl":{"start":{"line":5,"column":17},"end":{"line":5,"column":26}},"loc":{"start":{"line":5,"column":34},"end":{"line":5,"column":99}},"line":5},"5":{"name":"rejected","decl":{"start":{"line":6,"column":17},"end":{"line":6,"column":25}},"loc":{"start":{"line":6,"column":33},"end":{"line":6,"column":102}},"line":6},"6":{"name":"step","decl":{"start":{"line":7,"column":17},"end":{"line":7,"column":21}},"loc":{"start":{"line":7,"column":30},"end":{"line":7,"column":118}},"line":7},"7":{"name":"(anonymous_7)","decl":{"start":{"line":11,"column":56},"end":{"line":11,"column":57}},"loc":{"start":{"line":11,"column":71},"end":{"line":13,"column":1}},"line":11},"8":{"name":"(anonymous_8)","decl":{"start":{"line":28,"column":21},"end":{"line":28,"column":22}},"loc":{"start":{"line":28,"column":27},"end":{"line":76,"column":2}},"line":28},"9":{"name":"(anonymous_9)","decl":{"start":{"line":28,"column":61},"end":{"line":28,"column":62}},"loc":{"start":{"line":28,"column":74},"end":{"line":76,"column":1}},"line":28}},"branchMap":{"0":{"loc":{"start":{"line":2,"column":16},"end":{"line":10,"column":1}},"type":"binary-expr","locations":[{"start":{"line":2,"column":17},"end":{"line":2,"column":21}},{"start":{"line":2,"column":25},"end":{"line":2,"column":39}},{"start":{"line":2,"column":44},"end":{"line":10,"column":1}}],"line":2},"1":{"loc":{"start":{"line":3,"column":35},"end":{"line":3,"column":109}},"type":"cond-expr","locations":[{"start":{"line":3,"column":56},"end":{"line":3,"column":61}},{"start":{"line":3,"column":64},"end":{"line":3,"column":109}}],"line":3},"2":{"loc":{"start":{"line":4,"column":16},"end":{"line":4,"column":34}},"type":"binary-expr","locations":[{"start":{"line":4,"column":16},"end":{"line":4,"column":17}},{"start":{"line":4,"column":22},"end":{"line":4,"column":33}}],"line":4},"3":{"loc":{"start":{"line":7,"column":32},"end":{"line":7,"column":115}},"type":"cond-expr","locations":[{"start":{"line":7,"column":46},"end":{"line":7,"column":67}},{"start":{"line":7,"column":70},"end":{"line":7,"column":115}}],"line":7},"4":{"loc":{"start":{"line":8,"column":51},"end":{"line":8,"column":67}},"type":"binary-expr","locations":[{"start":{"line":8,"column":51},"end":{"line":8,"column":61}},{"start":{"line":8,"column":65},"end":{"line":8,"column":67}}],"line":8},"5":{"loc":{"start":{"line":11,"column":22},"end":{"line":13,"column":1}},"type":"binary-expr","locations":[{"start":{"line":11,"column":23},"end":{"line":11,"column":27}},{"start":{"line":11,"column":31},"end":{"line":11,"column":51}},{"start":{"line":11,"column":56},"end":{"line":13,"column":1}}],"line":11},"6":{"loc":{"start":{"line":12,"column":11},"end":{"line":12,"column":61}},"type":"cond-expr","locations":[{"start":{"line":12,"column":37},"end":{"line":12,"column":40}},{"start":{"line":12,"column":43},"end":{"line":12,"column":61}}],"line":12},"7":{"loc":{"start":{"line":12,"column":12},"end":{"line":12,"column":33}},"type":"binary-expr","locations":[{"start":{"line":12,"column":12},"end":{"line":12,"column":15}},{"start":{"line":12,"column":19},"end":{"line":12,"column":33}}],"line":12},"8":{"loc":{"start":{"line":32,"column":16},"end":{"line":32,"column":109}},"type":"cond-expr","locations":[{"start":{"line":32,"column":100},"end":{"line":32,"column":102}},{"start":{"line":32,"column":105},"end":{"line":32,"column":109}}],"line":32},"9":{"loc":{"start":{"line":32,"column":16},"end":{"line":32,"column":97}},"type":"binary-expr","locations":[{"start":{"line":32,"column":16},"end":{"line":32,"column":80}},{"start":{"line":32,"column":84},"end":{"line":32,"column":97}}],"line":32}},"s":{"0":1,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":1,"13":2,"14":1,"15":1,"16":1,"17":1,"18":1,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0},"f":{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":2,"8":0,"9":0},"b":{"0":[1,1,1],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[1,1,1],"6":[1,1],"7":[2,2],"8":[0,0],"9":[0,0]},"inputSourceMap":{"version":3,"file":"C:/Users/EuanMorgan/Documents/Code/Yakka/Yakka-Api/src/utils/createServer.ts","sources":["C:/Users/EuanMorgan/Documents/Code/Yakka/Yakka-Api/src/utils/createServer.ts"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA,sDAA8B;AAC9B,sDAA8B;AAC9B,qCAAwC;AACxC,4EAAoD;AACpD,4EAAoD;AACpD,4EAAoD;AACpD,wDAAiC;AACjC,yEAImC;AACnC,+DAA8C;AAC9C,qEAAmD;AACnD,qDAA6C;AAC7C,0EAAkD;AAElD,+EAA+E;AAC/E,MAAM,YAAY,GAAG,GAAS,EAAE;;IAC/B,6CAA6C;IAC7C,MAAM,GAAG,GAAG,IAAA,iBAAO,EAAC;QACnB,MAAM,EAAE,MAAA,qBAAY,CAAC,gBAAM,CAAC,QAAQ,CAAC,mCAAI,IAAI;KAC7C,CAAC,CAAC;IAEH,qBAAqB;IAErB,GAAG,CAAC,QAAQ,CAAC,sBAAY,CAAC,CAAC;IAE3B,GAAG,CAAC,QAAQ,CAAC,aAAI,CAAC,CAAC;IAEnB,kBAAkB;IAClB,GAAG,CAAC,oBAAoB,CAAC,6CAAiB,CAAC,CAAC;IAC5C,GAAG,CAAC,qBAAqB,CAAC,8CAAkB,CAAC,CAAC;IAE9C,GAAG,CAAC,QAAQ,CAAC,iBAAc,EAAE;QAC5B,SAAS,EAAE,+CAAmB;QAC9B,OAAO,EAAE;YACR,IAAI,EAAE;gBACL,KAAK,EAAE,WAAW;gBAClB,WAAW,EAAE,WAAW;gBACxB,OAAO,EAAP,sBAAO;aACP;YACD,UAAU,EAAE;gBACX,eAAe,EAAE;oBAChB,UAAU,EAAE;wBACX,IAAI,EAAE,MAAM;wBACZ,MAAM,EAAE,QAAQ;wBAChB,YAAY,EAAE,KAAK;wBACnB,WAAW,EACV,iIAAiI;qBAClI;iBACD;aACD;SACD;KACD,CAAC,CAAC;IAEH,GAAG,CAAC,QAAQ,CAAC,oBAAgB,EAAE;QAC9B,WAAW,EAAE,OAAO;QACpB,SAAS,EAAE,IAAI;KACf,CAAC,CAAC;IAEH,kBAAkB;IAElB,+BAA+B;IAC/B,GAAG,CAAC,QAAQ,CAAC,oBAAU,CAAC,CAAC;IACzB,GAAG,CAAC,QAAQ,CAAC,oBAAU,EAAE,EAAE,MAAM,EAAE,YAAY,EAAE,CAAC,CAAC;IACnD,GAAG,CAAC,QAAQ,CAAC,oBAAU,EAAE,EAAE,MAAM,EAAE,WAAW,EAAE,CAAC,CAAC;IAClD,2BAA2B;IAC3B,8CAA8C;IAC9C,kEAAkE;IAClE,+DAA+D;IAC/D,QAAQ;IAER,MAAM;IACN,OAAO,GAAG,CAAC;AACZ,CAAC,CAAA,CAAC;AAEF,kBAAe,YAAY,CAAC","sourcesContent":["import fastify from \"fastify\";\nimport config from \"./config\";\nimport { loggerConfig } from \"./logger\";\nimport userRoutes from \"../modules/user/user.route\";\nimport authRoutes from \"../modules/auth/auth.route\";\nimport miscRoutes from \"../modules/misc/misc.route\";\nimport fjwt from \"./plugins/jwt\";\nimport {\n\tjsonSchemaTransform,\n\tserializerCompiler,\n\tvalidatorCompiler,\n} from \"fastify-type-provider-zod\";\nimport fastifySwagger from \"@fastify/swagger\";\nimport fastifySwaggerUi from \"@fastify/swagger-ui\";\nimport { version } from \"../../package.json\";\nimport errorHandler from \"./plugins/errorHandler\";\n\n// We separate the server creation into its own function to make testing easier\nconst createServer = async () => {\n\t// TODO: Register CORS plugin for admin panel\n\tconst app = fastify({\n\t\tlogger: loggerConfig[config.NODE_ENV] ?? true,\n\t});\n\n\t//   Register Plugins\n\n\tapp.register(errorHandler);\n\n\tapp.register(fjwt);\n\n\t// Zod and swagger\n\tapp.setValidatorCompiler(validatorCompiler);\n\tapp.setSerializerCompiler(serializerCompiler);\n\n\tapp.register(fastifySwagger, {\n\t\ttransform: jsonSchemaTransform,\n\t\topenapi: {\n\t\t\tinfo: {\n\t\t\t\ttitle: \"Yakka API\",\n\t\t\t\tdescription: \"Yakka API\",\n\t\t\t\tversion,\n\t\t\t},\n\t\t\tcomponents: {\n\t\t\t\tsecuritySchemes: {\n\t\t\t\t\tbearerAuth: {\n\t\t\t\t\t\ttype: \"http\",\n\t\t\t\t\t\tscheme: \"bearer\",\n\t\t\t\t\t\tbearerFormat: \"JWT\",\n\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\"JWT Authorization header using the Bearer scheme. Put your access token in the header. Example: 'Authorization: Bearer {token}'\",\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t});\n\n\tapp.register(fastifySwaggerUi, {\n\t\troutePrefix: \"/docs\",\n\t\tstaticCSP: true,\n\t});\n\n\t// Register routes\n\n\t// Finally, register the routes\n\tapp.register(miscRoutes);\n\tapp.register(userRoutes, { prefix: \"/api/users\" });\n\tapp.register(authRoutes, { prefix: \"/api/auth\" });\n\t// app.ready().then(() => {\n\t// \t// if (config.NODE_ENV === 'production') {\n\t// \t//   server.scheduler.addSimpleIntervalJob(commentCounterJob);\n\t// \t//   server.scheduler.addSimpleIntervalJob(likeCounterJob);\n\t// \t// }\n\n\t// });\n\treturn app;\n};\n\nexport default createServer;\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"1a378bff0e69e048ae6679e165c770766f45eea0","contentHash":"918580c8ac01d6d798d6f393e0de11e802a0a7ba1f5137f029ee4555ebf61a36"},"C:\\Users\\EuanMorgan\\Documents\\Code\\Yakka\\Yakka-Api\\src\\utils\\config.ts":{"path":"C:\\Users\\EuanMorgan\\Documents\\Code\\Yakka\\Yakka-Api\\src\\utils\\config.ts","statementMap":{"0":{"start":{"line":2,"column":22},"end":{"line":12,"column":3}},"1":{"start":{"line":3,"column":4},"end":{"line":3,"column":33}},"2":{"start":{"line":3,"column":26},"end":{"line":3,"column":33}},"3":{"start":{"line":4,"column":15},"end":{"line":4,"column":52}},"4":{"start":{"line":5,"column":4},"end":{"line":7,"column":5}},"5":{"start":{"line":6,"column":6},"end":{"line":6,"column":68}},"6":{"start":{"line":6,"column":51},"end":{"line":6,"column":63}},"7":{"start":{"line":8,"column":4},"end":{"line":8,"column":39}},"8":{"start":{"line":10,"column":4},"end":{"line":10,"column":33}},"9":{"start":{"line":10,"column":26},"end":{"line":10,"column":33}},"10":{"start":{"line":11,"column":4},"end":{"line":11,"column":17}},"11":{"start":{"line":13,"column":25},"end":{"line":17,"column":2}},"12":{"start":{"line":14,"column":4},"end":{"line":14,"column":72}},"13":{"start":{"line":16,"column":4},"end":{"line":16,"column":21}},"14":{"start":{"line":18,"column":19},"end":{"line":24,"column":1}},"15":{"start":{"line":19,"column":4},"end":{"line":19,"column":42}},"16":{"start":{"line":19,"column":31},"end":{"line":19,"column":42}},"17":{"start":{"line":20,"column":17},"end":{"line":20,"column":19}},"18":{"start":{"line":21,"column":4},"end":{"line":21,"column":141}},"19":{"start":{"line":21,"column":21},"end":{"line":21,"column":141}},"20":{"start":{"line":21,"column":40},"end":{"line":21,"column":141}},"21":{"start":{"line":21,"column":109},"end":{"line":21,"column":141}},"22":{"start":{"line":22,"column":4},"end":{"line":22,"column":36}},"23":{"start":{"line":23,"column":4},"end":{"line":23,"column":18}},"24":{"start":{"line":25,"column":0},"end":{"line":25,"column":62}},"25":{"start":{"line":26,"column":14},"end":{"line":26,"column":28}},"26":{"start":{"line":27,"column":15},"end":{"line":27,"column":46}},"27":{"start":{"line":28,"column":0},"end":{"line":28,"column":16}},"28":{"start":{"line":29,"column":18},"end":{"line":57,"column":2}},"29":{"start":{"line":58,"column":15},"end":{"line":58,"column":47}},"30":{"start":{"line":59,"column":0},"end":{"line":62,"column":1}},"31":{"start":{"line":60,"column":4},"end":{"line":60,"column":102}},"32":{"start":{"line":61,"column":4},"end":{"line":61,"column":20}},"33":{"start":{"line":63,"column":0},"end":{"line":63,"column":30}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":2,"column":74},"end":{"line":2,"column":75}},"loc":{"start":{"line":2,"column":96},"end":{"line":9,"column":1}},"line":2},"1":{"name":"(anonymous_1)","decl":{"start":{"line":6,"column":38},"end":{"line":6,"column":39}},"loc":{"start":{"line":6,"column":49},"end":{"line":6,"column":65}},"line":6},"2":{"name":"(anonymous_2)","decl":{"start":{"line":9,"column":6},"end":{"line":9,"column":7}},"loc":{"start":{"line":9,"column":28},"end":{"line":12,"column":1}},"line":9},"3":{"name":"(anonymous_3)","decl":{"start":{"line":13,"column":80},"end":{"line":13,"column":81}},"loc":{"start":{"line":13,"column":95},"end":{"line":15,"column":1}},"line":13},"4":{"name":"(anonymous_4)","decl":{"start":{"line":15,"column":5},"end":{"line":15,"column":6}},"loc":{"start":{"line":15,"column":20},"end":{"line":17,"column":1}},"line":15},"5":{"name":"(anonymous_5)","decl":{"start":{"line":18,"column":50},"end":{"line":18,"column":51}},"loc":{"start":{"line":18,"column":65},"end":{"line":24,"column":1}},"line":18}},"branchMap":{"0":{"loc":{"start":{"line":2,"column":22},"end":{"line":12,"column":3}},"type":"binary-expr","locations":[{"start":{"line":2,"column":23},"end":{"line":2,"column":27}},{"start":{"line":2,"column":31},"end":{"line":2,"column":51}},{"start":{"line":2,"column":57},"end":{"line":12,"column":2}}],"line":2},"1":{"loc":{"start":{"line":2,"column":57},"end":{"line":12,"column":2}},"type":"cond-expr","locations":[{"start":{"line":2,"column":74},"end":{"line":9,"column":1}},{"start":{"line":9,"column":6},"end":{"line":12,"column":1}}],"line":2},"2":{"loc":{"start":{"line":3,"column":4},"end":{"line":3,"column":33}},"type":"if","locations":[{"start":{"line":3,"column":4},"end":{"line":3,"column":33}},{"start":{"line":3,"column":4},"end":{"line":3,"column":33}}],"line":3},"3":{"loc":{"start":{"line":5,"column":4},"end":{"line":7,"column":5}},"type":"if","locations":[{"start":{"line":5,"column":4},"end":{"line":7,"column":5}},{"start":{"line":5,"column":4},"end":{"line":7,"column":5}}],"line":5},"4":{"loc":{"start":{"line":5,"column":8},"end":{"line":5,"column":85}},"type":"binary-expr","locations":[{"start":{"line":5,"column":8},"end":{"line":5,"column":13}},{"start":{"line":5,"column":18},"end":{"line":5,"column":84}}],"line":5},"5":{"loc":{"start":{"line":5,"column":18},"end":{"line":5,"column":84}},"type":"cond-expr","locations":[{"start":{"line":5,"column":34},"end":{"line":5,"column":47}},{"start":{"line":5,"column":50},"end":{"line":5,"column":84}}],"line":5},"6":{"loc":{"start":{"line":5,"column":50},"end":{"line":5,"column":84}},"type":"binary-expr","locations":[{"start":{"line":5,"column":50},"end":{"line":5,"column":63}},{"start":{"line":5,"column":67},"end":{"line":5,"column":84}}],"line":5},"7":{"loc":{"start":{"line":10,"column":4},"end":{"line":10,"column":33}},"type":"if","locations":[{"start":{"line":10,"column":4},"end":{"line":10,"column":33}},{"start":{"line":10,"column":4},"end":{"line":10,"column":33}}],"line":10},"8":{"loc":{"start":{"line":13,"column":25},"end":{"line":17,"column":2}},"type":"binary-expr","locations":[{"start":{"line":13,"column":26},"end":{"line":13,"column":30}},{"start":{"line":13,"column":34},"end":{"line":13,"column":57}},{"start":{"line":13,"column":63},"end":{"line":17,"column":1}}],"line":13},"9":{"loc":{"start":{"line":13,"column":63},"end":{"line":17,"column":1}},"type":"cond-expr","locations":[{"start":{"line":13,"column":80},"end":{"line":15,"column":1}},{"start":{"line":15,"column":5},"end":{"line":17,"column":1}}],"line":13},"10":{"loc":{"start":{"line":18,"column":19},"end":{"line":24,"column":1}},"type":"binary-expr","locations":[{"start":{"line":18,"column":20},"end":{"line":18,"column":24}},{"start":{"line":18,"column":28},"end":{"line":18,"column":45}},{"start":{"line":18,"column":50},"end":{"line":24,"column":1}}],"line":18},"11":{"loc":{"start":{"line":19,"column":4},"end":{"line":19,"column":42}},"type":"if","locations":[{"start":{"line":19,"column":4},"end":{"line":19,"column":42}},{"start":{"line":19,"column":4},"end":{"line":19,"column":42}}],"line":19},"12":{"loc":{"start":{"line":19,"column":8},"end":{"line":19,"column":29}},"type":"binary-expr","locations":[{"start":{"line":19,"column":8},"end":{"line":19,"column":11}},{"start":{"line":19,"column":15},"end":{"line":19,"column":29}}],"line":19},"13":{"loc":{"start":{"line":21,"column":4},"end":{"line":21,"column":141}},"type":"if","locations":[{"start":{"line":21,"column":4},"end":{"line":21,"column":141}},{"start":{"line":21,"column":4},"end":{"line":21,"column":141}}],"line":21},"14":{"loc":{"start":{"line":21,"column":40},"end":{"line":21,"column":141}},"type":"if","locations":[{"start":{"line":21,"column":40},"end":{"line":21,"column":141}},{"start":{"line":21,"column":40},"end":{"line":21,"column":141}}],"line":21},"15":{"loc":{"start":{"line":21,"column":44},"end":{"line":21,"column":107}},"type":"binary-expr","locations":[{"start":{"line":21,"column":44},"end":{"line":21,"column":59}},{"start":{"line":21,"column":63},"end":{"line":21,"column":107}}],"line":21},"16":{"loc":{"start":{"line":59,"column":0},"end":{"line":62,"column":1}},"type":"if","locations":[{"start":{"line":59,"column":0},"end":{"line":62,"column":1}},{"start":{"line":59,"column":0},"end":{"line":62,"column":1}}],"line":59}},"s":{"0":1,"1":2,"2":2,"3":2,"4":2,"5":2,"6":1,"7":2,"8":0,"9":0,"10":0,"11":1,"12":1,"13":0,"14":1,"15":1,"16":0,"17":1,"18":1,"19":1,"20":2,"21":2,"22":1,"23":1,"24":1,"25":1,"26":1,"27":1,"28":1,"29":1,"30":1,"31":0,"32":0,"33":1},"f":{"0":2,"1":1,"2":0,"3":1,"4":0,"5":1},"b":{"0":[1,1,1],"1":[1,0],"2":[2,0],"3":[2,0],"4":[2,2],"5":[0,2],"6":[2,0],"7":[0,0],"8":[1,1,1],"9":[1,0],"10":[1,1,1],"11":[0,1],"12":[1,1],"13":[1,0],"14":[2,0],"15":[2,2],"16":[0,1]},"inputSourceMap":{"version":3,"file":"C:/Users/EuanMorgan/Documents/Code/Yakka/Yakka-Api/src/utils/config.ts","sources":["C:/Users/EuanMorgan/Documents/Code/Yakka/Yakka-Api/src/utils/config.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAA,6BAAwB;AACxB,+CAAiC;AACjC,MAAM,CAAC,MAAM,EAAE,CAAC;AAChB,MAAM,SAAS,GAAG,OAAC,CAAC,MAAM,CAAC;IAC1B,IAAI,EAAE,OAAC,CAAC,MAAM,EAAE,CAAC,OAAO,CAAC,SAAS,CAAC;IACnC,IAAI,EAAE,OAAC,CAAC,MAAM,EAAE,CAAC,OAAO,CAAC,IAAI,CAAC;IAC9B,QAAQ,EAAE,OAAC;SACT,IAAI,CAAC,CAAC,aAAa,EAAE,YAAY,EAAE,MAAM,CAAC,CAAC;SAC3C,OAAO,CAAC,aAAa,CAAC;IACxB,QAAQ,EAAE,OAAC,CAAC,MAAM,EAAE,CAAC,GAAG,EAAE;IAC1B,cAAc,EAAE,OAAC,CAAC,MAAM,EAAE;IAC1B,YAAY,EAAE,OAAC,CAAC,MAAM,EAAE;IACxB,mBAAmB,EAAE,OAAC,CAAC,MAAM,EAAE;IAC/B,2BAA2B,EAAE,OAAC,CAAC,MAAM,EAAE;IACvC,iBAAiB,EAAE,OAAC,CAAC,MAAM,EAAE;IAC7B,oBAAoB,EAAE,OAAC,CAAC,MAAM,EAAE;IAChC,wBAAwB,EAAE,OAAC,CAAC,MAAM,EAAE;IACpC,eAAe,EAAE,OAAC,CAAC,MAAM,EAAE;IAC3B,aAAa,EAAE,OAAC,CAAC,MAAM,EAAE;IACzB,YAAY,EAAE,OAAC,CAAC,MAAM,EAAE;IACxB,mBAAmB,EAAE,OAAC,CAAC,MAAM,EAAE;IAC/B,mBAAmB,EAAE,OAAC,CAAC,MAAM,EAAE;IAC/B,kBAAkB,EAAE,OAAC,CAAC,MAAM,EAAE;IAC9B,sBAAsB,EAAE,OAAC,CAAC,MAAM,EAAE;IAClC,cAAc,EAAE,OAAC,CAAC,MAAM,EAAE;IAC1B,eAAe,EAAE,OAAC,CAAC,MAAM,EAAE;IAC3B,kBAAkB,EAAE,OAAC,CAAC,MAAM,EAAE;IAC9B,cAAc,EAAE,OAAC,CAAC,MAAM,EAAE;IAC1B,SAAS,EAAE,OAAC,CAAC,MAAM,EAAE;IACrB,aAAa,EAAE,OAAC,CAAC,MAAM,EAAE;IACzB,aAAa,EAAE,OAAC,CAAC,MAAM,EAAE;CACzB,CAAC,CAAC;AAEH,MAAM,MAAM,GAAG,SAAS,CAAC,SAAS,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;AAEhD,IAAI,CAAC,MAAM,CAAC,OAAO,EAAE;IACpB,OAAO,CAAC,KAAK,CACZ,kCAAkC,EAClC,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,KAAK,CAAC,MAAM,EAAE,EAAE,IAAI,EAAE,CAAC,CAAC,CAC9C,CAAC;IACF,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;CAChB;AAED,kBAAe,MAAM,CAAC,IAAI,CAAC","sourcesContent":["import { z } from \"zod\";\nimport * as dotenv from \"dotenv\";\ndotenv.config();\nconst envSchema = z.object({\n\tHOST: z.string().default(\"0.0.0.0\"),\n\tPORT: z.number().default(4000),\n\tNODE_ENV: z\n\t\t.enum([\"development\", \"production\", \"test\"])\n\t\t.default(\"development\"),\n\tBASE_URL: z.string().url(),\n\tAPP_URL_SCHEME: z.string(),\n\tDATABASE_URL: z.string(),\n\tSHADOW_DATABASE_URL: z.string(),\n\tRESET_PASSWORD_TOKEN_SECRET: z.string(),\n\tENCRYPTION_SECRET: z.string(),\n\tGOOGLE_IOS_CLIENT_ID: z.string(),\n\tGOOGLE_ANDROID_CLIENT_ID: z.string(),\n\tAPPLE_CLIENT_ID: z.string(),\n\tAPPLE_TEAM_ID: z.string(),\n\tAPPLE_KEY_ID: z.string(),\n\tAPPLE_CLIENT_SECRET: z.string(),\n\tFACEBOOK_APP_SECRET: z.string(),\n\tLINKEDIN_CLIENT_ID: z.string(),\n\tLINKEDIN_CLIENT_SECRET: z.string(),\n\tSNS_LAMBDA_URL: z.string(),\n\tMAILJET_API_KEY: z.string(),\n\tMAILJET_API_SECRET: z.string(),\n\tS3_BUCKET_NAME: z.string(),\n\tS3_REGION: z.string(),\n\tS3_ACCESS_KEY: z.string(),\n\tS3_SECRET_KEY: z.string(),\n});\n\nconst parsed = envSchema.safeParse(process.env);\n\nif (!parsed.success) {\n\tconsole.error(\n\t\t\"❌ Invalid environment variables:\",\n\t\tJSON.stringify(parsed.error.format(), null, 4)\n\t);\n\tprocess.exit(1);\n}\n\nexport default parsed.data;\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"709c5f492945341dc2e55cd0ef30ce33832de6c6","contentHash":"c11c9f462f3b66db4895afe7a32d450fd86a3bb91dc2bcfd4c867f439c9201f7"},"C:\\Users\\EuanMorgan\\Documents\\Code\\Yakka\\Yakka-Api\\src\\utils\\logger.ts":{"path":"C:\\Users\\EuanMorgan\\Documents\\Code\\Yakka\\Yakka-Api\\src\\utils\\logger.ts","statementMap":{"0":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"1":{"start":{"line":3,"column":4},"end":{"line":3,"column":62}},"2":{"start":{"line":5,"column":0},"end":{"line":5,"column":62}},"3":{"start":{"line":6,"column":0},"end":{"line":6,"column":30}},"4":{"start":{"line":7,"column":15},"end":{"line":7,"column":47}},"5":{"start":{"line":8,"column":17},"end":{"line":8,"column":53}},"6":{"start":{"line":10,"column":0},"end":{"line":26,"column":2}},"7":{"start":{"line":32,"column":23},"end":{"line":32,"column":70}},"8":{"start":{"line":33,"column":15},"end":{"line":37,"column":21}},"9":{"start":{"line":38,"column":0},"end":{"line":38,"column":25}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":2,"column":56},"end":{"line":2,"column":57}},"loc":{"start":{"line":2,"column":71},"end":{"line":4,"column":1}},"line":2}},"branchMap":{"0":{"loc":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"type":"binary-expr","locations":[{"start":{"line":2,"column":23},"end":{"line":2,"column":27}},{"start":{"line":2,"column":31},"end":{"line":2,"column":51}},{"start":{"line":2,"column":56},"end":{"line":4,"column":1}}],"line":2},"1":{"loc":{"start":{"line":3,"column":11},"end":{"line":3,"column":61}},"type":"cond-expr","locations":[{"start":{"line":3,"column":37},"end":{"line":3,"column":40}},{"start":{"line":3,"column":43},"end":{"line":3,"column":61}}],"line":3},"2":{"loc":{"start":{"line":3,"column":12},"end":{"line":3,"column":33}},"type":"binary-expr","locations":[{"start":{"line":3,"column":12},"end":{"line":3,"column":15}},{"start":{"line":3,"column":19},"end":{"line":3,"column":33}}],"line":3},"3":{"loc":{"start":{"line":33,"column":35},"end":{"line":37,"column":20}},"type":"cond-expr","locations":[{"start":{"line":34,"column":6},"end":{"line":36,"column":5}},{"start":{"line":37,"column":6},"end":{"line":37,"column":20}}],"line":33}},"s":{"0":1,"1":2,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1},"f":{"0":2},"b":{"0":[1,1,1],"1":[1,1],"2":[2,2],"3":[1,0]},"inputSourceMap":{"version":3,"file":"C:/Users/EuanMorgan/Documents/Code/Yakka/Yakka-Api/src/utils/logger.ts","sources":["C:/Users/EuanMorgan/Documents/Code/Yakka/Yakka-Api/src/utils/logger.ts"],"names":[],"mappings":";;;;;;AAAA,gDAAwB;AACxB,sDAA8B;AAC9B,wDAAwD;AAC3C,QAAA,YAAY,GAAG;IAC3B,qCAAqC;IACrC,qDAAqD;IACrD,WAAW,EAAE;QACZ,SAAS,EAAE;YACV,MAAM,EAAE,aAAa;YACrB,OAAO,EAAE;gBACR,aAAa,EAAE,YAAY;gBAC3B,MAAM,EAAE,cAAc;aACtB;SACD;KACD;IACD,oCAAoC;IACpC,UAAU,EAAE,IAAI;IAChB,oBAAoB;IACpB,IAAI,EAAE,KAAK;CACX,CAAC;AAEF,kEAAkE;AAClE,uEAAuE;AACvE,iCAAiC;AACjC,yEAAyE;AACzE,qDAAqD;AACrD,MAAM,cAAc,GAAG,oBAAY,CAAC,gBAAM,CAAC,QAAQ,CAAC,CAAC;AACrD,MAAM,MAAM,GAAG,IAAA,cAAI,EAClB,OAAO,cAAc,KAAK,SAAS;IAClC,CAAC,CAAC;QACA,OAAO,EAAE,cAAc;KACtB;IACH,CAAC,CAAC,cAAc,CACjB,CAAC;AAEF,kBAAe,MAAM,CAAC","sourcesContent":["import pino from \"pino\";\nimport config from \"./config\";\n// https://www.fastify.io/docs/latest/Reference/Logging/\nexport const loggerConfig = {\n\t// Provide pretty logs in development\n\t// Format the time and ignore hostname and process id\n\tdevelopment: {\n\t\ttransport: {\n\t\t\ttarget: \"pino-pretty\",\n\t\t\toptions: {\n\t\t\t\ttranslateTime: \"HH:MM:ss Z\",\n\t\t\t\tignore: \"pid,hostname\",\n\t\t\t},\n\t\t},\n\t},\n\t// Provide normal logs in production\n\tproduction: true,\n\t// Don't log in test\n\ttest: false,\n};\n\n// Fastify will use a built in logger and automatically log events\n// The logger is attatched the the fastify instance and request objects\n// So we can use it in our routes\n// However, we also export a global logger here to use it in other places\n// where we don't have access to the fastify instance\nconst selectedConfig = loggerConfig[config.NODE_ENV];\nconst logger = pino(\n\ttypeof selectedConfig === \"boolean\"\n\t\t? {\n\t\t\t\tenabled: selectedConfig,\n\t\t  }\n\t\t: selectedConfig\n);\n\nexport default logger;\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"705ca6b0955dfdf7d23b2b5e55bfa245a0577d12","contentHash":"64e97ae6ce94d82b0d4463e3fcbd87f2ded99dce25d8a2133982e2e1bb70d519"},"C:\\Users\\EuanMorgan\\Documents\\Code\\Yakka\\Yakka-Api\\src\\modules\\user\\user.route.ts":{"path":"C:\\Users\\EuanMorgan\\Documents\\Code\\Yakka\\Yakka-Api\\src\\modules\\user\\user.route.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":24},"end":{"line":3,"column":60}},"2":{"start":{"line":4,"column":26},"end":{"line":4,"column":54}},"3":{"start":{"line":5,"column":22},"end":{"line":5,"column":46}},"4":{"start":{"line":6,"column":19},"end":{"line":42,"column":1}},"5":{"start":{"line":7,"column":4},"end":{"line":20,"column":54}},"6":{"start":{"line":23,"column":4},"end":{"line":40,"column":57}},"7":{"start":{"line":41,"column":4},"end":{"line":41,"column":11}},"8":{"start":{"line":43,"column":0},"end":{"line":43,"column":29}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":6,"column":19},"end":{"line":6,"column":20}},"loc":{"start":{"line":6,"column":37},"end":{"line":42,"column":1}},"line":6}},"branchMap":{},"s":{"0":1,"1":1,"2":1,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0},"f":{"0":0},"b":{},"inputSourceMap":{"version":3,"file":"C:/Users/EuanMorgan/Documents/Code/Yakka/Yakka-Api/src/modules/user/user.route.ts","sources":["C:/Users/EuanMorgan/Documents/Code/Yakka/Yakka-Api/src/modules/user/user.route.ts"],"names":[],"mappings":";;AACA,6DAGmC;AACnC,uDAG2B;AAC3B,+CAGuB;AACvB,MAAM,UAAU,GAAG,CAClB,GAAoB,EACpB,CAAuB,EACvB,IAAkC,EACjC,EAAE;IACH,GAAG,CAAC,GAAG,CACN,qBAAqB,EACrB;QACC,MAAM,EAAE;YACP,OAAO,EAAE,qCAAqC;YAC9C,QAAQ,EAAE;gBACT,GAAG,EAAE,wCAA0B;aAC/B;YACD,QAAQ,EAAE;gBACT;oBACC,UAAU,EAAE,EAAE;iBACd;aACD;SACD;QACD,SAAS,EAAE,GAAG,CAAC,YAAY;KAC3B,EACD,6CAA2B,CAC3B,CAAC;IAEF,mBAAmB;IACnB,qHAAqH;IACrH,GAAG,CAAC,IAAI,CACP,qBAAqB,EACrB;QACC,MAAM,EAAE;YACP,OAAO,EAAE,6BAA6B;YACtC,IAAI,EAAE,2CAA6B;YACnC,QAAQ,EAAE;gBACT,8BAA8B;gBAC9B,GAAG,EAAE,mCAAmB,CAAC,QAAQ,CAAC,mBAAmB,CAAC;gBACtD,GAAG,EAAE,mCAAmB,CAAC,QAAQ,CAChC,oCAAoC,CACpC;gBACD,GAAG,EAAE,mCAAmB,CAAC,QAAQ,CAAC,wBAAwB,CAAC;aAC3D;YACD,QAAQ,EAAE;gBACT;oBACC,UAAU,EAAE,EAAE;iBACd;aACD;SACD;QACD,SAAS,EAAE,GAAG,CAAC,YAAY;KAC3B,EACD,gDAA8B,CAC9B,CAAC;IAEF,IAAI,EAAE,CAAC;AACR,CAAC,CAAC;AAEF,kBAAe,UAAU,CAAC","sourcesContent":["import { FastifyError, FastifyInstance, FastifyPluginOptions } from \"fastify\";\r\nimport {\r\n\tdefaultResponseSchema,\r\n\terrorResponseSchema,\r\n} from \"../../types/globalSchemas\";\r\nimport {\r\n\tgetVerificationImageHandler,\r\n\tuploadVerificationImageHandler,\r\n} from \"./user.controller\";\r\nimport {\r\n\tgetVerificationImageSchema,\r\n\tuploadVerificationImageSchema,\r\n} from \"./user.schema\";\r\nconst userRoutes = (\r\n\tapp: FastifyInstance,\r\n\t_: FastifyPluginOptions,\r\n\tdone: (err?: FastifyError) => void\r\n) => {\r\n\tapp.get(\r\n\t\t\"/image-verification\",\r\n\t\t{\r\n\t\t\tschema: {\r\n\t\t\t\tsummary: \"Get a random gesture example image.\",\r\n\t\t\t\tresponse: {\r\n\t\t\t\t\t200: getVerificationImageSchema,\r\n\t\t\t\t},\r\n\t\t\t\tsecurity: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tbearerAuth: [],\r\n\t\t\t\t\t},\r\n\t\t\t\t],\r\n\t\t\t},\r\n\t\t\tonRequest: app.authenticate,\r\n\t\t},\r\n\t\tgetVerificationImageHandler\r\n\t);\r\n\r\n\t// upload image url\r\n\t// TODO: Look into making a type or somethhing which automatically adds the security schema and the authenticate hook\r\n\tapp.post(\r\n\t\t\"/image-verification\",\r\n\t\t{\r\n\t\t\tschema: {\r\n\t\t\t\tsummary: \"Upload a verification image\",\r\n\t\t\t\tbody: uploadVerificationImageSchema,\r\n\t\t\t\tresponse: {\r\n\t\t\t\t\t// 200: defaultResponseSchema,\r\n\t\t\t\t\t404: errorResponseSchema.describe(\"Gesture not found\"),\r\n\t\t\t\t\t409: errorResponseSchema.describe(\r\n\t\t\t\t\t\t\"User has already uploaded an image\"\r\n\t\t\t\t\t),\r\n\t\t\t\t\t500: errorResponseSchema.describe(\"Could not upload image\"),\r\n\t\t\t\t},\r\n\t\t\t\tsecurity: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tbearerAuth: [],\r\n\t\t\t\t\t},\r\n\t\t\t\t],\r\n\t\t\t},\r\n\t\t\tonRequest: app.authenticate,\r\n\t\t},\r\n\t\tuploadVerificationImageHandler\r\n\t);\r\n\r\n\tdone();\r\n};\r\n\r\nexport default userRoutes;\r\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"27d521629f7ead75faaf7cc2c8b48651b08874cc","contentHash":"3068085e85d91f252dd24baffba21668fa0385acbd2d89fcbdc3e5bdc03177c6"},"C:\\Users\\EuanMorgan\\Documents\\Code\\Yakka\\Yakka-Api\\src\\types\\globalSchemas.ts":{"path":"C:\\Users\\EuanMorgan\\Documents\\Code\\Yakka\\Yakka-Api\\src\\types\\globalSchemas.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":69}},"2":{"start":{"line":4,"column":14},"end":{"line":4,"column":28}},"3":{"start":{"line":5,"column":0},"end":{"line":7,"column":3}},"4":{"start":{"line":8,"column":0},"end":{"line":10,"column":3}}},"fnMap":{},"branchMap":{},"s":{"0":1,"1":1,"2":1,"3":1,"4":1},"f":{},"b":{},"inputSourceMap":{"version":3,"file":"C:/Users/EuanMorgan/Documents/Code/Yakka/Yakka-Api/src/types/globalSchemas.ts","sources":["C:/Users/EuanMorgan/Documents/Code/Yakka/Yakka-Api/src/types/globalSchemas.ts"],"names":[],"mappings":";;;AAAA,6BAAwB;AAEX,QAAA,qBAAqB,GAAG,OAAC,CAAC,MAAM,CAAC;IAC7C,OAAO,EAAE,OAAC,CAAC,MAAM,EAAE;CACnB,CAAC,CAAC;AAEU,QAAA,mBAAmB,GAAG,6BAAqB,CAAC,MAAM,CAAC;IAC/D,SAAS,EAAE,OAAC,CAAC,MAAM,EAAE,CAAC,QAAQ,EAAE;CAChC,CAAC,CAAC","sourcesContent":["import { z } from \"zod\";\n\nexport const defaultResponseSchema = z.object({\n\tmessage: z.string(),\n});\n\nexport const errorResponseSchema = defaultResponseSchema.extend({\n\terrorCode: z.string().optional(),\n});\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"4619d36502c241e5a557e5f3e754bf790c7ac57d","contentHash":"4878780b8244ff7201de8b12960b83ecbd16908036ee755ed2026a4aeaff008a"},"C:\\Users\\EuanMorgan\\Documents\\Code\\Yakka\\Yakka-Api\\src\\modules\\user\\user.controller.ts":{"path":"C:\\Users\\EuanMorgan\\Documents\\Code\\Yakka\\Yakka-Api\\src\\modules\\user\\user.controller.ts","statementMap":{"0":{"start":{"line":2,"column":16},"end":{"line":10,"column":1}},"1":{"start":{"line":3,"column":28},"end":{"line":3,"column":110}},"2":{"start":{"line":3,"column":91},"end":{"line":3,"column":106}},"3":{"start":{"line":4,"column":4},"end":{"line":9,"column":7}},"4":{"start":{"line":5,"column":36},"end":{"line":5,"column":97}},"5":{"start":{"line":5,"column":42},"end":{"line":5,"column":70}},"6":{"start":{"line":5,"column":85},"end":{"line":5,"column":95}},"7":{"start":{"line":6,"column":35},"end":{"line":6,"column":100}},"8":{"start":{"line":6,"column":41},"end":{"line":6,"column":73}},"9":{"start":{"line":6,"column":88},"end":{"line":6,"column":98}},"10":{"start":{"line":7,"column":32},"end":{"line":7,"column":116}},"11":{"start":{"line":8,"column":8},"end":{"line":8,"column":78}},"12":{"start":{"line":11,"column":13},"end":{"line":21,"column":1}},"13":{"start":{"line":12,"column":12},"end":{"line":12,"column":14}},"14":{"start":{"line":13,"column":4},"end":{"line":14,"column":20}},"15":{"start":{"line":13,"column":21},"end":{"line":14,"column":20}},"16":{"start":{"line":14,"column":8},"end":{"line":14,"column":20}},"17":{"start":{"line":15,"column":4},"end":{"line":19,"column":9}},"18":{"start":{"line":16,"column":8},"end":{"line":19,"column":9}},"19":{"start":{"line":16,"column":21},"end":{"line":16,"column":22}},"20":{"start":{"line":16,"column":28},"end":{"line":16,"column":59}},"21":{"start":{"line":17,"column":12},"end":{"line":18,"column":34}},"22":{"start":{"line":18,"column":16},"end":{"line":18,"column":34}},"23":{"start":{"line":20,"column":4},"end":{"line":20,"column":13}},"24":{"start":{"line":22,"column":22},"end":{"line":24,"column":1}},"25":{"start":{"line":23,"column":4},"end":{"line":23,"column":62}},"26":{"start":{"line":25,"column":0},"end":{"line":25,"column":62}},"27":{"start":{"line":26,"column":0},"end":{"line":26,"column":86}},"28":{"start":{"line":27,"column":18},"end":{"line":27,"column":51}},"29":{"start":{"line":28,"column":14},"end":{"line":28,"column":40}},"30":{"start":{"line":29,"column":17},"end":{"line":29,"column":63}},"31":{"start":{"line":30,"column":36},"end":{"line":43,"column":2}},"32":{"start":{"line":30,"column":56},"end":{"line":43,"column":2}},"33":{"start":{"line":31,"column":25},"end":{"line":31,"column":63}},"34":{"start":{"line":32,"column":26},"end":{"line":34,"column":6}},"35":{"start":{"line":35,"column":4},"end":{"line":37,"column":5}},"36":{"start":{"line":36,"column":8},"end":{"line":36,"column":78}},"37":{"start":{"line":38,"column":26},"end":{"line":38,"column":39}},"38":{"start":{"line":38,"column":48},"end":{"line":38,"column":84}},"39":{"start":{"line":39,"column":4},"end":{"line":42,"column":15}},"40":{"start":{"line":44,"column":0},"end":{"line":44,"column":66}},"41":{"start":{"line":45,"column":39},"end":{"line":80,"column":2}},"42":{"start":{"line":45,"column":59},"end":{"line":80,"column":2}},"43":{"start":{"line":46,"column":4},"end":{"line":79,"column":5}},"44":{"start":{"line":47,"column":38},"end":{"line":47,"column":50}},"45":{"start":{"line":48,"column":24},"end":{"line":52,"column":10}},"46":{"start":{"line":53,"column":8},"end":{"line":55,"column":9}},"47":{"start":{"line":54,"column":12},"end":{"line":54,"column":74}},"48":{"start":{"line":56,"column":35},"end":{"line":59,"column":10}},"49":{"start":{"line":60,"column":8},"end":{"line":66,"column":11}},"50":{"start":{"line":67,"column":8},"end":{"line":67,"column":46}},"51":{"start":{"line":70,"column":8},"end":{"line":70,"column":29}},"52":{"start":{"line":71,"column":8},"end":{"line":77,"column":9}},"53":{"start":{"line":72,"column":12},"end":{"line":76,"column":13}},"54":{"start":{"line":73,"column":16},"end":{"line":75,"column":78}},"55":{"start":{"line":78,"column":8},"end":{"line":78,"column":77}},"56":{"start":{"line":81,"column":0},"end":{"line":81,"column":72}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":2,"column":44},"end":{"line":2,"column":45}},"loc":{"start":{"line":2,"column":89},"end":{"line":10,"column":1}},"line":2},"1":{"name":"adopt","decl":{"start":{"line":3,"column":13},"end":{"line":3,"column":18}},"loc":{"start":{"line":3,"column":26},"end":{"line":3,"column":112}},"line":3},"2":{"name":"(anonymous_2)","decl":{"start":{"line":3,"column":70},"end":{"line":3,"column":71}},"loc":{"start":{"line":3,"column":89},"end":{"line":3,"column":108}},"line":3},"3":{"name":"(anonymous_3)","decl":{"start":{"line":4,"column":36},"end":{"line":4,"column":37}},"loc":{"start":{"line":4,"column":63},"end":{"line":9,"column":5}},"line":4},"4":{"name":"fulfilled","decl":{"start":{"line":5,"column":17},"end":{"line":5,"column":26}},"loc":{"start":{"line":5,"column":34},"end":{"line":5,"column":99}},"line":5},"5":{"name":"rejected","decl":{"start":{"line":6,"column":17},"end":{"line":6,"column":25}},"loc":{"start":{"line":6,"column":33},"end":{"line":6,"column":102}},"line":6},"6":{"name":"step","decl":{"start":{"line":7,"column":17},"end":{"line":7,"column":21}},"loc":{"start":{"line":7,"column":30},"end":{"line":7,"column":118}},"line":7},"7":{"name":"(anonymous_7)","decl":{"start":{"line":11,"column":38},"end":{"line":11,"column":39}},"loc":{"start":{"line":11,"column":54},"end":{"line":21,"column":1}},"line":11},"8":{"name":"(anonymous_8)","decl":{"start":{"line":22,"column":56},"end":{"line":22,"column":57}},"loc":{"start":{"line":22,"column":71},"end":{"line":24,"column":1}},"line":22},"9":{"name":"(anonymous_9)","decl":{"start":{"line":30,"column":36},"end":{"line":30,"column":37}},"loc":{"start":{"line":30,"column":56},"end":{"line":43,"column":2}},"line":30},"10":{"name":"(anonymous_10)","decl":{"start":{"line":30,"column":90},"end":{"line":30,"column":91}},"loc":{"start":{"line":30,"column":103},"end":{"line":43,"column":1}},"line":30},"11":{"name":"(anonymous_11)","decl":{"start":{"line":45,"column":39},"end":{"line":45,"column":40}},"loc":{"start":{"line":45,"column":59},"end":{"line":80,"column":2}},"line":45},"12":{"name":"(anonymous_12)","decl":{"start":{"line":45,"column":93},"end":{"line":45,"column":94}},"loc":{"start":{"line":45,"column":106},"end":{"line":80,"column":1}},"line":45}},"branchMap":{"0":{"loc":{"start":{"line":2,"column":16},"end":{"line":10,"column":1}},"type":"binary-expr","locations":[{"start":{"line":2,"column":17},"end":{"line":2,"column":21}},{"start":{"line":2,"column":25},"end":{"line":2,"column":39}},{"start":{"line":2,"column":44},"end":{"line":10,"column":1}}],"line":2},"1":{"loc":{"start":{"line":3,"column":35},"end":{"line":3,"column":109}},"type":"cond-expr","locations":[{"start":{"line":3,"column":56},"end":{"line":3,"column":61}},{"start":{"line":3,"column":64},"end":{"line":3,"column":109}}],"line":3},"2":{"loc":{"start":{"line":4,"column":16},"end":{"line":4,"column":34}},"type":"binary-expr","locations":[{"start":{"line":4,"column":16},"end":{"line":4,"column":17}},{"start":{"line":4,"column":22},"end":{"line":4,"column":33}}],"line":4},"3":{"loc":{"start":{"line":7,"column":32},"end":{"line":7,"column":115}},"type":"cond-expr","locations":[{"start":{"line":7,"column":46},"end":{"line":7,"column":67}},{"start":{"line":7,"column":70},"end":{"line":7,"column":115}}],"line":7},"4":{"loc":{"start":{"line":8,"column":51},"end":{"line":8,"column":67}},"type":"binary-expr","locations":[{"start":{"line":8,"column":51},"end":{"line":8,"column":61}},{"start":{"line":8,"column":65},"end":{"line":8,"column":67}}],"line":8},"5":{"loc":{"start":{"line":11,"column":13},"end":{"line":21,"column":1}},"type":"binary-expr","locations":[{"start":{"line":11,"column":14},"end":{"line":11,"column":18}},{"start":{"line":11,"column":22},"end":{"line":11,"column":33}},{"start":{"line":11,"column":38},"end":{"line":21,"column":1}}],"line":11},"6":{"loc":{"start":{"line":13,"column":21},"end":{"line":14,"column":20}},"type":"if","locations":[{"start":{"line":13,"column":21},"end":{"line":14,"column":20}},{"start":{"line":13,"column":21},"end":{"line":14,"column":20}}],"line":13},"7":{"loc":{"start":{"line":13,"column":25},"end":{"line":13,"column":87}},"type":"binary-expr","locations":[{"start":{"line":13,"column":25},"end":{"line":13,"column":67}},{"start":{"line":13,"column":71},"end":{"line":13,"column":87}}],"line":13},"8":{"loc":{"start":{"line":15,"column":4},"end":{"line":19,"column":9}},"type":"if","locations":[{"start":{"line":15,"column":4},"end":{"line":19,"column":9}},{"start":{"line":15,"column":4},"end":{"line":19,"column":9}}],"line":15},"9":{"loc":{"start":{"line":15,"column":8},"end":{"line":15,"column":71}},"type":"binary-expr","locations":[{"start":{"line":15,"column":8},"end":{"line":15,"column":17}},{"start":{"line":15,"column":21},"end":{"line":15,"column":71}}],"line":15},"10":{"loc":{"start":{"line":17,"column":12},"end":{"line":18,"column":34}},"type":"if","locations":[{"start":{"line":17,"column":12},"end":{"line":18,"column":34}},{"start":{"line":17,"column":12},"end":{"line":18,"column":34}}],"line":17},"11":{"loc":{"start":{"line":17,"column":16},"end":{"line":17,"column":90}},"type":"binary-expr","locations":[{"start":{"line":17,"column":16},"end":{"line":17,"column":35}},{"start":{"line":17,"column":39},"end":{"line":17,"column":90}}],"line":17},"12":{"loc":{"start":{"line":22,"column":22},"end":{"line":24,"column":1}},"type":"binary-expr","locations":[{"start":{"line":22,"column":23},"end":{"line":22,"column":27}},{"start":{"line":22,"column":31},"end":{"line":22,"column":51}},{"start":{"line":22,"column":56},"end":{"line":24,"column":1}}],"line":22},"13":{"loc":{"start":{"line":23,"column":11},"end":{"line":23,"column":61}},"type":"cond-expr","locations":[{"start":{"line":23,"column":37},"end":{"line":23,"column":40}},{"start":{"line":23,"column":43},"end":{"line":23,"column":61}}],"line":23},"14":{"loc":{"start":{"line":23,"column":12},"end":{"line":23,"column":33}},"type":"binary-expr","locations":[{"start":{"line":23,"column":12},"end":{"line":23,"column":15}},{"start":{"line":23,"column":19},"end":{"line":23,"column":33}}],"line":23},"15":{"loc":{"start":{"line":35,"column":4},"end":{"line":37,"column":5}},"type":"if","locations":[{"start":{"line":35,"column":4},"end":{"line":37,"column":5}},{"start":{"line":35,"column":4},"end":{"line":37,"column":5}}],"line":35},"16":{"loc":{"start":{"line":53,"column":8},"end":{"line":55,"column":9}},"type":"if","locations":[{"start":{"line":53,"column":8},"end":{"line":55,"column":9}},{"start":{"line":53,"column":8},"end":{"line":55,"column":9}}],"line":53},"17":{"loc":{"start":{"line":71,"column":8},"end":{"line":77,"column":9}},"type":"if","locations":[{"start":{"line":71,"column":8},"end":{"line":77,"column":9}},{"start":{"line":71,"column":8},"end":{"line":77,"column":9}}],"line":71},"18":{"loc":{"start":{"line":72,"column":12},"end":{"line":76,"column":13}},"type":"if","locations":[{"start":{"line":72,"column":12},"end":{"line":76,"column":13}},{"start":{"line":72,"column":12},"end":{"line":76,"column":13}}],"line":72}},"s":{"0":1,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":1,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":1,"25":0,"26":1,"27":1,"28":1,"29":1,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0},"f":{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0},"b":{"0":[1,1,1],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[1,1,1],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[1,1,1],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0]},"inputSourceMap":{"version":3,"file":"C:/Users/EuanMorgan/Documents/Code/Yakka/Yakka-Api/src/modules/user/user.controller.ts","sources":["C:/Users/EuanMorgan/Documents/Code/Yakka/Yakka-Api/src/modules/user/user.controller.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,oDAAuE;AAEvE,yCAAqE;AACrE,gEAAwC;AAGjC,MAAM,2BAA2B,GAAG,CAC1C,OAAuB,EACvB,KAAmB,EAClB,EAAE;IACH,MAAM,YAAY,GAAG,MAAM,gBAAM,CAAC,OAAO,CAAC,KAAK,EAAE,CAAC;IAClD,MAAM,aAAa,GAAG,MAAM,gBAAM,CAAC,OAAO,CAAC,SAAS,CAAC;QACpD,IAAI,EAAE,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,EAAE,GAAG,YAAY,CAAC;KAC9C,CAAC,CAAC;IAEH,IAAI,CAAC,aAAa,EAAE;QACnB,OAAO,KAAK,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,KAAK,EAAE,2BAA2B,EAAE,CAAC,CAAC;KACtE;IAED,MAAM,EAAE,SAAS,KAAc,aAAa,EAAtB,IAAI,UAAK,aAAa,EAAtC,aAAsB,CAAgB,CAAC;IAE7C,OAAO,KAAK,CAAC,IAAI,iCACb,IAAI,KACP,QAAQ,EAAE,IAAA,iBAAW,EAAC;YACrB,QAAQ,EAAE,aAAa,CAAC,SAAS;YACjC,IAAI,EAAE,mBAAmB;SACzB,CAAC,IACD,CAAC;AACJ,CAAC,CAAA,CAAC;AAtBW,QAAA,2BAA2B,+BAsBtC;AAEK,MAAM,8BAA8B,GAAG,CAC7C,OAEE,EACF,KAAmB,EAClB,EAAE;IACH,IAAI;QACH,MAAM,EAAE,MAAM,EAAE,SAAS,EAAE,GAAG,OAAO,CAAC,IAAI,CAAC;QAE3C,MAAM,OAAO,GAAG,MAAM,gBAAM,CAAC,OAAO,CAAC,UAAU,CAAC;YAC/C,KAAK,EAAE;gBACN,EAAE,EAAE,SAAS;aACb;SACD,CAAC,CAAC;QAEH,IAAI,CAAC,OAAO,EAAE;YACb,OAAO,KAAK,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,KAAK,EAAE,mBAAmB,EAAE,CAAC,CAAC;SAC9D;QAED,MAAM,EAAE,GAAG,EAAE,SAAS,EAAE,GAAG,MAAM,IAAA,2BAAqB,EAAC;YACtD,MAAM;YACN,IAAI,EAAE,gBAAgB;SACtB,CAAC,CAAC;QACH,MAAM,gBAAM,CAAC,qBAAqB,CAAC,MAAM,CAAC;YACzC,IAAI,EAAE;gBACL,MAAM,EAAE,OAAO,CAAC,IAAI,CAAC,EAAE;gBACvB,SAAS;gBACT,SAAS;aACT;SACD,CAAC,CAAC;QACH,OAAO,KAAK,CAAC,IAAI,CAAC,EAAE,GAAG,EAAE,SAAS,EAAE,CAAC,CAAC;KACtC;IAAC,OAAO,KAAK,EAAE;QACf,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;QACrB,IAAI,KAAK,YAAY,uCAA6B,EAAE;YACnD,IAAI,KAAK,CAAC,IAAI,KAAK,OAAO,EAAE;gBAC3B,OAAO,KAAK;qBACV,MAAM,CAAC,GAAG,CAAC;qBACX,IAAI,CAAC,EAAE,OAAO,EAAE,qCAAqC,EAAE,CAAC,CAAC;aAC3D;SACD;QACD,OAAO,KAAK,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,OAAO,EAAE,wBAAwB,EAAE,CAAC,CAAC;KACrE;AACF,CAAC,CAAA,CAAC;AA1CW,QAAA,8BAA8B,kCA0CzC","sourcesContent":["import { PrismaClientKnownRequestError } from \"@prisma/client/runtime\";\r\nimport type { FastifyRequest, FastifyReply } from \"fastify\";\r\nimport { formatS3Url, uploadBase64ImageToS3 } from \"../../utils/aws\";\r\nimport prisma from \"../../utils/prisma\";\r\nimport { UploadVerificationImageSchema } from \"./user.schema\";\r\n\r\nexport const getVerificationImageHandler = async (\r\n\trequest: FastifyRequest,\r\n\treply: FastifyReply\r\n) => {\r\n\tconst gestureCount = await prisma.gesture.count();\r\n\tconst randomGesture = await prisma.gesture.findFirst({\r\n\t\tskip: Math.floor(Math.random() * gestureCount),\r\n\t});\r\n\r\n\tif (!randomGesture) {\r\n\t\treturn reply.status(500).send({ error: \"Could not find a gesture.\" });\r\n\t}\r\n\r\n\tconst { imageName, ...rest } = randomGesture;\r\n\r\n\treturn reply.send({\r\n\t\t...rest,\r\n\t\timageUrl: formatS3Url({\r\n\t\t\tfileName: randomGesture.imageName,\r\n\t\t\tpath: \"gestures/examples\",\r\n\t\t}),\r\n\t});\r\n};\r\n\r\nexport const uploadVerificationImageHandler = async (\r\n\trequest: FastifyRequest<{\r\n\t\tBody: UploadVerificationImageSchema;\r\n\t}>,\r\n\treply: FastifyReply\r\n) => {\r\n\ttry {\r\n\t\tconst { base64, gestureId } = request.body;\r\n\r\n\t\tconst gesture = await prisma.gesture.findUnique({\r\n\t\t\twhere: {\r\n\t\t\t\tid: gestureId,\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tif (!gesture) {\r\n\t\t\treturn reply.status(404).send({ error: \"Gesture not found\" });\r\n\t\t}\r\n\r\n\t\tconst { url, imageName } = await uploadBase64ImageToS3({\r\n\t\t\tbase64,\r\n\t\t\tpath: \"gestures/users\",\r\n\t\t});\r\n\t\tawait prisma.userVerificationImage.create({\r\n\t\t\tdata: {\r\n\t\t\t\tuserId: request.user.id,\r\n\t\t\t\tgestureId,\r\n\t\t\t\timageName,\r\n\t\t\t},\r\n\t\t});\r\n\t\treturn reply.send({ url, imageName });\r\n\t} catch (error) {\r\n\t\tconsole.error(error);\r\n\t\tif (error instanceof PrismaClientKnownRequestError) {\r\n\t\t\tif (error.code === \"P2002\") {\r\n\t\t\t\treturn reply\r\n\t\t\t\t\t.status(409)\r\n\t\t\t\t\t.send({ message: \"You have already uploaded an image.\" });\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn reply.status(500).send({ message: \"Could not upload image\" });\r\n\t}\r\n};\r\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"b126336ca86550760185ad43b24b9e3a2fec278f","contentHash":"5f81369c4739783eb65423123f123884466aceb25b6687841065f34fa24e5dff"},"C:\\Users\\EuanMorgan\\Documents\\Code\\Yakka\\Yakka-Api\\src\\utils\\aws.ts":{"path":"C:\\Users\\EuanMorgan\\Documents\\Code\\Yakka\\Yakka-Api\\src\\utils\\aws.ts","statementMap":{"0":{"start":{"line":2,"column":16},"end":{"line":10,"column":1}},"1":{"start":{"line":3,"column":28},"end":{"line":3,"column":110}},"2":{"start":{"line":3,"column":91},"end":{"line":3,"column":106}},"3":{"start":{"line":4,"column":4},"end":{"line":9,"column":7}},"4":{"start":{"line":5,"column":36},"end":{"line":5,"column":97}},"5":{"start":{"line":5,"column":42},"end":{"line":5,"column":70}},"6":{"start":{"line":5,"column":85},"end":{"line":5,"column":95}},"7":{"start":{"line":6,"column":35},"end":{"line":6,"column":100}},"8":{"start":{"line":6,"column":41},"end":{"line":6,"column":73}},"9":{"start":{"line":6,"column":88},"end":{"line":6,"column":98}},"10":{"start":{"line":7,"column":32},"end":{"line":7,"column":116}},"11":{"start":{"line":8,"column":8},"end":{"line":8,"column":78}},"12":{"start":{"line":11,"column":22},"end":{"line":13,"column":1}},"13":{"start":{"line":12,"column":4},"end":{"line":12,"column":62}},"14":{"start":{"line":14,"column":0},"end":{"line":14,"column":62}},"15":{"start":{"line":15,"column":0},"end":{"line":15,"column":74}},"16":{"start":{"line":16,"column":18},"end":{"line":16,"column":53}},"17":{"start":{"line":17,"column":17},"end":{"line":17,"column":34}},"18":{"start":{"line":18,"column":17},"end":{"line":18,"column":53}},"19":{"start":{"line":22,"column":0},"end":{"line":26,"column":3}},"20":{"start":{"line":28,"column":20},"end":{"line":28,"column":156}},"21":{"start":{"line":28,"column":45},"end":{"line":28,"column":156}},"22":{"start":{"line":29,"column":0},"end":{"line":29,"column":34}},"23":{"start":{"line":30,"column":30},"end":{"line":51,"column":2}},"24":{"start":{"line":30,"column":42},"end":{"line":51,"column":2}},"25":{"start":{"line":31,"column":23},"end":{"line":31,"column":99}},"26":{"start":{"line":32,"column":17},"end":{"line":32,"column":58}},"27":{"start":{"line":33,"column":21},"end":{"line":33,"column":56}},"28":{"start":{"line":34,"column":19},"end":{"line":40,"column":5}},"29":{"start":{"line":42,"column":19},"end":{"line":42,"column":63}},"30":{"start":{"line":44,"column":4},"end":{"line":50,"column":6}},"31":{"start":{"line":52,"column":0},"end":{"line":52,"column":54}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":2,"column":44},"end":{"line":2,"column":45}},"loc":{"start":{"line":2,"column":89},"end":{"line":10,"column":1}},"line":2},"1":{"name":"adopt","decl":{"start":{"line":3,"column":13},"end":{"line":3,"column":18}},"loc":{"start":{"line":3,"column":26},"end":{"line":3,"column":112}},"line":3},"2":{"name":"(anonymous_2)","decl":{"start":{"line":3,"column":70},"end":{"line":3,"column":71}},"loc":{"start":{"line":3,"column":89},"end":{"line":3,"column":108}},"line":3},"3":{"name":"(anonymous_3)","decl":{"start":{"line":4,"column":36},"end":{"line":4,"column":37}},"loc":{"start":{"line":4,"column":63},"end":{"line":9,"column":5}},"line":4},"4":{"name":"fulfilled","decl":{"start":{"line":5,"column":17},"end":{"line":5,"column":26}},"loc":{"start":{"line":5,"column":34},"end":{"line":5,"column":99}},"line":5},"5":{"name":"rejected","decl":{"start":{"line":6,"column":17},"end":{"line":6,"column":25}},"loc":{"start":{"line":6,"column":33},"end":{"line":6,"column":102}},"line":6},"6":{"name":"step","decl":{"start":{"line":7,"column":17},"end":{"line":7,"column":21}},"loc":{"start":{"line":7,"column":30},"end":{"line":7,"column":118}},"line":7},"7":{"name":"(anonymous_7)","decl":{"start":{"line":11,"column":56},"end":{"line":11,"column":57}},"loc":{"start":{"line":11,"column":71},"end":{"line":13,"column":1}},"line":11},"8":{"name":"(anonymous_8)","decl":{"start":{"line":28,"column":20},"end":{"line":28,"column":21}},"loc":{"start":{"line":28,"column":45},"end":{"line":28,"column":156}},"line":28},"9":{"name":"(anonymous_9)","decl":{"start":{"line":30,"column":30},"end":{"line":30,"column":31}},"loc":{"start":{"line":30,"column":42},"end":{"line":51,"column":2}},"line":30},"10":{"name":"(anonymous_10)","decl":{"start":{"line":30,"column":76},"end":{"line":30,"column":77}},"loc":{"start":{"line":30,"column":89},"end":{"line":51,"column":1}},"line":30}},"branchMap":{"0":{"loc":{"start":{"line":2,"column":16},"end":{"line":10,"column":1}},"type":"binary-expr","locations":[{"start":{"line":2,"column":17},"end":{"line":2,"column":21}},{"start":{"line":2,"column":25},"end":{"line":2,"column":39}},{"start":{"line":2,"column":44},"end":{"line":10,"column":1}}],"line":2},"1":{"loc":{"start":{"line":3,"column":35},"end":{"line":3,"column":109}},"type":"cond-expr","locations":[{"start":{"line":3,"column":56},"end":{"line":3,"column":61}},{"start":{"line":3,"column":64},"end":{"line":3,"column":109}}],"line":3},"2":{"loc":{"start":{"line":4,"column":16},"end":{"line":4,"column":34}},"type":"binary-expr","locations":[{"start":{"line":4,"column":16},"end":{"line":4,"column":17}},{"start":{"line":4,"column":22},"end":{"line":4,"column":33}}],"line":4},"3":{"loc":{"start":{"line":7,"column":32},"end":{"line":7,"column":115}},"type":"cond-expr","locations":[{"start":{"line":7,"column":46},"end":{"line":7,"column":67}},{"start":{"line":7,"column":70},"end":{"line":7,"column":115}}],"line":7},"4":{"loc":{"start":{"line":8,"column":51},"end":{"line":8,"column":67}},"type":"binary-expr","locations":[{"start":{"line":8,"column":51},"end":{"line":8,"column":61}},{"start":{"line":8,"column":65},"end":{"line":8,"column":67}}],"line":8},"5":{"loc":{"start":{"line":11,"column":22},"end":{"line":13,"column":1}},"type":"binary-expr","locations":[{"start":{"line":11,"column":23},"end":{"line":11,"column":27}},{"start":{"line":11,"column":31},"end":{"line":11,"column":51}},{"start":{"line":11,"column":56},"end":{"line":13,"column":1}}],"line":11},"6":{"loc":{"start":{"line":12,"column":11},"end":{"line":12,"column":61}},"type":"cond-expr","locations":[{"start":{"line":12,"column":37},"end":{"line":12,"column":40}},{"start":{"line":12,"column":43},"end":{"line":12,"column":61}}],"line":12},"7":{"loc":{"start":{"line":12,"column":12},"end":{"line":12,"column":33}},"type":"binary-expr","locations":[{"start":{"line":12,"column":12},"end":{"line":12,"column":15}},{"start":{"line":12,"column":19},"end":{"line":12,"column":33}}],"line":12}},"s":{"0":1,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0},"f":{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":1,"8":0,"9":0,"10":0},"b":{"0":[1,1,1],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[1,1,1],"6":[0,1],"7":[1,1]},"inputSourceMap":{"version":3,"file":"C:/Users/EuanMorgan/Documents/Code/Yakka/Yakka-Api/src/utils/aws.ts","sources":["C:/Users/EuanMorgan/Documents/Code/Yakka/Yakka-Api/src/utils/aws.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;AAAA,sDAA0B;AAE1B,mCAAgC;AAChC,sDAA8B;AAC9B,iDAAiD;AACjD,qEAAqE;AACrE,wFAAwF;AAC3E,QAAA,EAAE,GAAG,IAAI,iBAAG,CAAC,EAAE,CAAC;IAC5B,MAAM,EAAE,gBAAM,CAAC,SAAS;IACxB,WAAW,EAAE,gBAAM,CAAC,aAAa;IACjC,eAAe,EAAE,gBAAM,CAAC,aAAa;CACrC,CAAC,CAAC;AAEH,mBAAmB;AAEZ,MAAM,WAAW,GAAG,CAAC,EAC3B,IAAI,EACJ,QAAQ,GAIR,EAAE,EAAE,CACJ,WAAW,gBAAM,CAAC,cAAc,OAAO,gBAAM,CAAC,SAAS,kBAAkB,IAAI,IAAI,QAAQ,EAAE,CAAC;AAPhF,QAAA,WAAW,eAOqE;AAOtF,MAAM,qBAAqB,GAAG,CAAO,MAAwB,EAAE,EAAE;IACvE,MAAM,UAAU,GAAG,MAAM,CAAC,IAAI,CAC7B,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,0BAA0B,EAAE,EAAE,CAAC,EACrD,QAAQ,CACR,CAAC;IACF,MAAM,IAAI,GAAG,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;IACvD,MAAM,QAAQ,GAAG,GAAG,IAAA,eAAM,GAAE,IAAI,IAAI,EAAE,CAAC;IACvC,MAAM,MAAM,GAAqB;QAChC,MAAM,EAAE,OAAO,CAAC,GAAG,CAAC,cAAe;QACnC,GAAG,EAAE,GAAG,MAAM,CAAC,IAAI,IAAI,QAAQ,EAAE;QACjC,IAAI,EAAE,UAAU;QAChB,eAAe,EAAE,QAAQ;QACzB,WAAW,EAAE,SAAS,IAAI,EAAE;KAC5B,CAAC;IAEF,mCAAmC;IACnC,MAAM,MAAM,GAAG,MAAM,UAAE,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC,OAAO,EAAE,CAAC;IAEpD,wCAAwC;IAExC,OAAO;QACN,GAAG,EAAE,IAAA,mBAAW,EAAC;YAChB,QAAQ;YACR,IAAI,EAAE,MAAM,CAAC,IAAI;SACjB,CAAC;QACF,SAAS,EAAE,QAAQ;KACnB,CAAC;AACH,CAAC,CAAA,CAAC;AA3BW,QAAA,qBAAqB,yBA2BhC","sourcesContent":["import AWS from \"aws-sdk\";\r\nimport { PutObjectRequest } from \"aws-sdk/clients/s3\";\r\nimport { nanoid } from \"nanoid\";\r\nimport config from \"./config\";\r\n// TODO: Ideally we would block all public access\r\n// And configure a bucket polciy to allow read access to some objects\r\n// https://aws.amazon.com/premiumsupport/knowledge-center/read-access-objects-s3-bucket/\r\nexport const s3 = new AWS.S3({\r\n\tregion: config.S3_REGION,\r\n\taccessKeyId: config.S3_ACCESS_KEY,\r\n\tsecretAccessKey: config.S3_SECRET_KEY,\r\n});\r\n\r\n// Helper functions\r\n\r\nexport const formatS3Url = ({\r\n\tpath,\r\n\tfileName,\r\n}: {\r\n\tpath: string;\r\n\tfileName: string;\r\n}) =>\r\n\t`https://${config.S3_BUCKET_NAME}.s3.${config.S3_REGION}.amazonaws.com/${path}/${fileName}`;\r\n\r\ninterface UploadToS3Params {\r\n\tbase64: string;\r\n\tpath: string;\r\n}\r\n\r\nexport const uploadBase64ImageToS3 = async (params: UploadToS3Params) => {\r\n\tconst base64Data = Buffer.from(\r\n\t\tparams.base64.replace(/^data:image\\/\\w+;base64,/, \"\"),\r\n\t\t\"base64\"\r\n\t);\r\n\tconst type = params.base64.split(\";\")[0].split(\"/\")[1];\r\n\tconst fileName = `${nanoid()}.${type}`;\r\n\tconst config: PutObjectRequest = {\r\n\t\tBucket: process.env.S3_BUCKET_NAME!,\r\n\t\tKey: `${params.path}/${fileName}`,\r\n\t\tBody: base64Data,\r\n\t\tContentEncoding: \"base64\",\r\n\t\tContentType: `image/${type}`,\r\n\t};\r\n\r\n\t// Error should be caught by caller\r\n\tconst upload = await s3.putObject(config).promise();\r\n\r\n\t//  Return the URL of the uploaded image\r\n\r\n\treturn {\r\n\t\turl: formatS3Url({\r\n\t\t\tfileName,\r\n\t\t\tpath: params.path,\r\n\t\t}),\r\n\t\timageName: fileName,\r\n\t};\r\n};\r\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"10142f233e8b1ea3f78f46cff3ab059d3c2e558c","contentHash":"d8048a176252226313dd2633d9479854fcbaa669efb0569f89e00637ac7c502a"}}